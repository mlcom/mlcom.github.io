---
layout: default
---
<div class="container">
    <h1 class="font-weight-bold spanborder" itemprop="headline">
        <span>{{page.title}}</span>
    </h1>
    
    <div class="row">
        <div class="col-md-8">
            {% if page.image %}
            <img class="card-img-top mb-4 shadow-lg rounded" 
                 src="{% if page.image contains '://' %}{{ page.image }}{% else %}{{ page.image | absolute_url }}{% endif %}" 
                 alt="{{ page.title }}" 
                 loading="lazy"
                 width="800"
                 height="450">
            {% endif %}
            
            <div class="page-content" itemprop="text">
                {{ content }}
                
                <!-- Comments Section -->
                {% if page.comments == true %}
                    {% include comments.html %}
                {% endif %}
            </div>
        </div>
        
        <div class="col-md-4">
            {% include sidebar.html %}

            <!-- Currency Calculator -->
            <div class="card shadow-sm mb-4">
                <div class="card-body p-3">
                    <h5 class="card-title text-center mb-3">Currency Converter</h5>
                    <fieldset id="calculator-fieldset" disabled>
                        <div id="currency-calculator">
                            <div class="form-group mb-2">
                                <input type="number" id="amount" class="form-control form-control-sm" value="100" placeholder="Amount">
                            </div>
                            <div class="form-group mb-2">
                                <select id="from_currency" class="form-control form-control-sm"></select>
                            </div>
                            <div class="form-group mb-2">
                                <select id="to_currency" class="form-control form-control-sm"></select>
                            </div>
                            <button id="convert-button" class="btn btn-primary btn-sm w-100">Convert</button>
                            <div id="result_container" class="mt-2 text-center">
                                <div id="result_text" class="text-success font-weight-bold small"></div>
                                <p id="status_text" class="text-muted small mb-0"></p>
                            </div>
                        </div>
                    </fieldset>
                    <small class="text-muted d-block text-center mt-2">Rates updated daily</small>
                </div>
            </div>
            
            <!-- Table of Contents -->
            {% if page.toc %}
            <div class="sticky-top pt-3">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Table of Contents</h5>
                        <div id="toc"></div>
                    </div>
                </div>
            </div>
            
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                const headings = document.querySelectorAll('.page-content h2, .page-content h3');
                const toc = document.getElementById('toc');
                let currentList = toc;
                
                if (headings.length > 0) {
                    headings.forEach((heading, index) => {
                        if (!heading.id) {
                            heading.id = 'heading-' + index;
                        }
                        const listItem = document.createElement('li');
                        const link = document.createElement('a');
                        link.href = '#' + heading.id;
                        link.textContent = heading.textContent;
                        link.className = 'toc-link';
                        
                        if (heading.tagName === 'H2') {
                            currentList = document.createElement('ul');
                            currentList.className = 'toc-sublist';
                            listItem.appendChild(link);
                            listItem.appendChild(currentList);
                            toc.appendChild(listItem);
                        } else if (heading.tagName === 'H3') {
                            const subItem = document.createElement('li');
                            subItem.appendChild(link);
                            currentList.appendChild(subItem);
                        }
                    });
                } else {
                    toc.innerHTML = '<p class="text-muted small">No headings found in this article.</p>';
                }
            });
            </script>
            {% endif %}
        </div>
    </div>
</div>

<!-- Calculator Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const lastUpdated = "{{ site.data.rates.last_updated_utc | date_to_xmlschema }}";
    const conversionRates = {{ site.data.rates.rates | jsonify }};
    const currencyNames = {{ site.data.currency_names | jsonify }};

    const amountInput = document.getElementById('amount');
    const fromSelect = document.getElementById('from_currency');
    const toSelect = document.getElementById('to_currency');
    const convertButton = document.getElementById('convert-button');
    const resultText = document.getElementById('result_text');
    const statusText = document.getElementById('status_text');
    const fieldset = document.getElementById('calculator-fieldset');

    function populateCurrencies() {
        fromSelect.innerHTML = '';
        toSelect.innerHTML = '';
        for (const currencyCode in conversionRates) {
            const fullName = currencyNames[currencyCode] || currencyCode;
            const optionText = `${currencyCode} - ${fullName}`;
            fromSelect.add(new Option(optionText, currencyCode));
            toSelect.add(new Option(optionText, currencyCode));
        }
        fromSelect.value = 'SAR';
        toSelect.value = 'PKR';
        fieldset.disabled = false;
        statusText.textContent = `Rates last updated: ${new Date(lastUpdated).toLocaleString()}`;
    }

    function performConversion() {
        const amount = parseFloat(amountInput.value);
        const fromCurrency = fromSelect.value;
        const toCurrency = toSelect.value;

        if (isNaN(amount) || amount <= 0) {
            resultText.textContent = '';
            statusText.innerHTML = '<span class="text-danger">Please enter a valid amount greater than zero.</span>';
            return;
        }

        const rateFrom = conversionRates[fromCurrency];
        const rateTo = conversionRates[toCurrency];
        if (!rateFrom || !rateTo) {
            resultText.textContent = '';
            statusText.innerHTML = '<span class="text-danger">Currency data not available. Please try again later.</span>';
            return;
        }

        const convertedAmount = (amount / rateFrom) * rateTo;
        resultText.innerHTML = `
          ${amount.toLocaleString(undefined, {maximumFractionDigits: 2})} ${fromCurrency} =
          <strong class="text-primary">${convertedAmount.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 4})}</strong> ${toCurrency}
        `;
        statusText.textContent = `1 ${fromCurrency} = ${(rateTo / rateFrom).toFixed(6)} ${toCurrency}`;
    }

    convertButton.addEventListener('click', performConversion);
    amountInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') performConversion();
    });

    populateCurrencies();
});
</script>
